[build]
builder = "nixpacks"
buildCommand = "bun install && bun run build:railway"

[deploy]
startCommand = "bun run db:push && node server.js"
healthcheckPath = "/api/health"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10

[env]
DEPLOYMENT_MODE = "railway"
NODE_ENV = "production"
NEXTAUTH_URL = "${RAILWAY_STATIC_URL}"
NEXTAUTH_SECRET = "${NEXTAUTH_SECRET}"

# Database configuration will be auto-injected by Railway PostgreSQL plugin
# DATABASE_URL = "${DATABASE_URL}" # Automatically set by Railway PostgreSQL

# Application-specific environment variables
DEFAULT_LOCALE = "en"
DB_POOLING = "true"

[services.web]
name = "chalkboard-web"
source = "."

[services.web.variables]
PORT = "3000"

# Railway PostgreSQL plugin
[[services.web.plugins]]
name = "postgresql"